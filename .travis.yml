language: node_js

node_js:
  - "stable"

install:
  - npm install

cache:
  directories:
    - "node_modules"

env:
  global:
    - NODE_ENV=test

services:
  - postgresql

deploy:
  provider: heroku
  api_key:
    secure: "Qog1vOINiRbO/+q8GgcDZqaQJc0/s8VNX4lyW0PCM6Tpb19lKJqsjSA+r5oTVZLbpmBYo/+1uUb7eVHcDD302Q6nDUq/HN0YQiO5GIyqCMJWjlXMr1MyzRjOMm33qHZqZxITn+L4WWxORHMdiNVtsciOGtlgCEKDB23TTCXIA5/eyixf7ts4qeIUPGSMyoWOq2tZQQUHEM3JpNjUxJFxAk0JBclDX9M9SnHaBX/X55+KrZWzqz1NHqRAvIrw9RefZ+//yLDYQKpRm5fRbfAGxeLabcZzGo1oDz9MVbdLRZ1BNeNnr5OmBnwdf91Pmmebu3c86tN9m5UdDnk+Zp9tejHuSC9QmQ4NMb4o4x7d7tcBvJezQ96oJ60ZPTl9z806Y4c1IrqyWRV4c7xLsWu1SUrrNPslykvypEVjkVLvBuiNQ7WggaVrOejTirn81ldwH4Y5aqxgCinEvetYmBWLYTcfCkykOqetE5lPSL15i2ver1Xxd7HzC4MZYQY9D8xE3/ZLvRGTmfn/3PBraSr5eEDi8sgSt/IpZljfb7FNVJ+vUIj05rpMrkaNiZUnknoBel7zpv23yJhMc1UW9dfZIdXuf9eMEJmodKGpTWvGcINzNSiQJ4m2a1wZe1Hf5ZY7pUX/zTKgEa5KTZvTwfrLkIK90ml1kHvCSKsavoTcuXQ="
  app: wayfarerapi-andela
  on:
    repo: Ucheduk/WayFarer-API
    branch: develop

before_script:
  - psql -c 'create database wayfarer_test_db;' -U postgres
  - psql -c "ALTER USER postgres PASSWORD 'password'";
  - sh ./setup-test-db.sh
  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - chmod +x ./cc-test-reporter
  - ./cc-test-reporter before-build

script:
  - npm run test:coverage

after_script:
  - ./cc-test-reporter -p ./coverage/lcov.info after-build --exit-code $TRAVIS_TEST_RESULT

notifications:
  - email: flase
