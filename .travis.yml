language: node_js

node_js:
  - "stable"

install:
  - npm install

cache:
  directories:
    - "node_modules"

env:
  global:
    - NODE_ENV=test

services:
  - postgresql

deploy:
  provider: heroku
  api_key:
    secure: "HO4TtrqZg1/C8LCAXHBJCeFHokTqdt6xs5Vuv9fVocT6zxinMg86siQrTxtW4foNM0kjnwLP1HDAA5xVboKm4+/4/MdFCFzdpqleAduxBohVVntvK55yms0kK+gncSUKtUJ/p6q5P5h/107hDUU3XOIBR5jkCp2kukusxhWIE77jT4R5nB4U4YLCN3ZJsPpnOaEslmuYeOKEsfVBOjuik8blop7QS1eYilo0VewsJO5Y3WgTne8EKOpq5G9NYKvW1uni3lUE6Xu/fvb6IPQB1Yj+ps7KwLbLMtnXloAw7/QTfNLwWAnhpcPD8SEbOcj6jJ139o0Tm9jODLHdWyHqFLi1l/ZO2J98FUe8bISpCiMLBJPorXX5rdKiRnFFA49Zq9M9TiSsnZohTb5X9WJN9HaM+RdDGws72WRCJ2DYxNqfXuPp3vGyKqDY3ZIARvQ9HUfoelUaHMuEe626bP13FZzTkwkGMQViSw+iieUO706xVJ57Zl1Z4wgi0mBBilys4oz9yJmxi40N368DVY3TEUxrdPA3uyc1HkoNYTpJK+b+keFo7Sd2C4NTtUwz8pP1+XsF3Ch5lwpCTd1AnhL0oP4Pf+n5EEbyl9OdyPGHiQTBl6Y2Yj2R8r+ZoftnCSq2Dy8pW7tNvy90GIa2DTEG/i4+Ohkd1WcFLVgXikx6kmE="
  app: wayfarerapi-andela
  on:
    repo: Ucheduk/WayFarer-API
    branch: develop

before_script:
  - psql -c 'create database wayfarer_test_db;' -U postgres
  - psql -c "ALTER USER postgres PASSWORD 'password'";
  - sh ./setup-test-db.sh
  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - chmod +x ./cc-test-reporter
  - ./cc-test-reporter before-build

script:
  - npm run test:coverage

after_script:
  - ./cc-test-reporter -p ./coverage/lcov.info after-build --exit-code $TRAVIS_TEST_RESULT

notifications:
  - email: flase
